UI_PRODUCT_GANTT_PHASE2.md

pms（Flutter）製品別ガント – フェーズ2 仕様書（公式版）

※ 本仕様書は SPEC.md・UI_GANTT_PHASE1.md と並ぶ「公式UI仕様書」として扱う。
※ Codex は以後の修正で本仕様を破壊してはならない。

1. 目的

製品数が数百〜数千台に及ぶ大型物件でも、
工程進捗を 製品単位で絞り込んでガント表示できるビューを実装する。

工程別ビュー（フェーズ1）を土台に、
製品別ビュー（フェーズ2）を追加するが、
表示対象はフィルタで絞った製品のみに限定する（A方式）。

2. 禁止事項（SPEC.md・フェーズ1からの継続）

この仕様書では以下の変更は禁止とする：

DB構造の変更

process_groups / process_steps / process_progress_daily

products

進捗ルール

日付＋工程（step_id）＋製品ID＋完了台数

upsertDaily

計画バー＝UIのみ

実績バー＝DB集約のみ

ガント上での実績バー編集

フェーズ1のタイムライン計算／ズーム／スクロール同期を壊す変更

3. 製品別ガントの全体構成
3.1 画面は2構成
● 画面1：製品一覧（全件表示＋フィルタ）

全製品を表示（ListView + 遅延読み込みOK）

複数フィルタで絞る

チェックボックスで複数選択

「ガントで表示」ボタンで画面2へ遷移

● 画面2：製品別ガント（選択製品のみ）

選んだ製品（最大 150 行）をガント表示

工程グループ単位の実績バー（太）

計画バー（細、UIのみ）

スクロール・ズーム・日/週/月はフェーズ1と同一仕様

4. 製品フィルタ仕様（フェーズ2の核心）

製品一覧画面では以下のフィルタで絞り込む。
全項目は AND 条件で網羅される。

4.1 製品種別（member_type）

複数選択可：

柱

大梁

小梁

間柱

胴縁

母屋

その他

4.2 工区（area / block）

複数選択可
例：K1、K2、1F、2F、A工区 など

★ 4.3 高さフィルタ（柱＝節／梁・小梁他＝階）←今回最重要

高さ方向は部材種別で意味が異なるため、
UI上は 「高さ」フィルタ としてまとめて表示する。

内部ロジックは：

■ 柱（member_type = "柱"）の場合

高さキー：節（segment）

フィルタ例 → 1節 / 2節 / 3節 …

複数選択可

UI表示名：

「高さ（節）」など

絞り込みは segment で行う

floor（階）はサブ情報扱いで、高さフィルタの主用途にはしない

■ 大梁・小梁・間柱・胴縁・母屋・その他の場合

高さキー：階（floor）

フィルタ例 → 1F / 2F / 3F / RF

複数選択可

UI表示名：

「高さ（階）」

絞り込みは floor で行う

■ 実装ルール（重要）
if (product.member_type == "柱") {
    heightKey = product.segment;
} else {
    heightKey = product.floor;
}


高さフィルタは 1つのUI に見えるが、
内部処理は「柱→節」「梁他→階」を自動的に分岐させる。

4.4 断面寸法（section_size）

テキスト検索（部分一致）

H-600×200×12×20、□-200×200×9 など

値の種類が多いため自由入力が基本

4.5 製品符号（text search）

部分一致検索

C-2F-03、BM-12-4 など

4.6 工程状態フィルタ（progress status）

未着手

仕掛中

全工程完了

遅延（計画バー > 実績バー）

今日着手

今日完了

5. ガントで表示する行数の上限

描画負荷を安定させるため：

ガント画面に表示できる製品数は最大150行

150行を超える場合は
「製品数が多すぎます。フィルタで絞ってください。」
を表示しガント画面に遷移させない

6. 製品別ガント（画面2）仕様
6.1 左ツリー構造（2階層）
製品（product）
 ├ 一次加工
 ├ コア部
 ├ 仕口部
 ├ 大組部
 ├ 二次部材
 ├ 製品検査
 ├ 製品塗装
 ├ 積込
 └ 出荷

視認性

親（製品） → 背景：#F2F2F2、太字

子（工程グループ） → 背景：白、通常フォント、インデント

行高さは工程別と統一

6.2 実績バー（太）

DBの process_progress_daily を
product_id + process_group 単位で集約

開始日＝その工程が最初に進んだ日

終了日＝最後に進んだ日

進捗率＝完了台数 / 製品数量

6.3 計画バー（細）

UI専用

ドラッグ可能

DB保存禁止

製品行にも計画バーを出してよい（任意）

6.4 日/週/月・ズーム・スクロール

フェーズ1と完全同一のタイムライン挙動

displayStart / displayEnd

visibleDays / daysCount

ScrollController同期

ヘッダーと本体の位置ずれ禁止

7. フェーズ2でやらないこと

（フェーズ3以降の機能）

製品 → 工程グループ → 工程ステップの三階層ツリー

切断／孔あけなどのステップ単位の実績バー

Excel/PDF 出力（別フェーズ）

ガントの無限スクロール（年単位表示）

ミニマップから本体を操作する機能

3D風UI、アニメーション

8. Codex への指示

Codex は以後：

SPEC.md

UI_GANTT_PHASE1.md

UI_PRODUCT_GANTT_PHASE2.md（本仕様書）

これらを 変更不可の公式仕様 として扱い、
破壊的変更を行わないこと。

9. 保存場所
/pms/UI_PRODUCT_GANTT_PHASE2.md


以上。
本仕様は pms 製品別ガント（フェーズ2）の公式UI仕様書とする。
