UI_GANTT_PHASE1.md

pms（Flutter） ガントチャート UI – フェーズ1 仕様書
※ この文書は SPEC.md と同様に「公式仕様書」として扱う。
※ Codex による修正は常にこの仕様を前提とし、破壊しないこと。

1. 本仕様書の位置づけ

この文書は「ガントチャート画面（UI側）の公式仕様書（フェーズ1）」である。

DB・データ構造・進捗記録方式はすべて SPEC.md に従う。

本仕様書は UI の仕様のみを定義する。

Codex は以降の修正で 本仕様書に反する実装を行ってはならない。

2. SPEC.md（DB側）で変更禁止の事項

以下は本仕様書では扱わず、絶対に変更しない：

■ DB構造

process_groups

process_steps

process_progress_daily

■ 進捗ルール

進捗 ＝ 日付 + step_id + 完了台数

upsertDaily で上書き保存

未来日入力禁止

計画バーは UI 専用、DB 保存禁止

実績バーは DB（process_progress_daily）集約のみで描画

ガント上で実績バーをドラッグで更新する機能は禁止

3. ガントUI（フェーズ1 完了状態の仕様）
3.1 表示モード

ガント画面は以下3モードに対応し、切り替え時にエラーを起こさない：

日ビュー

週ビュー

月ビュー

どのモードでも例外（赤画面）にならないこと。

3.2 工程ツリー構造（左タスクリスト）
■ 親子構造

親：process_group

子：process_step

親の開閉（▶/▼）が可能

親を閉じたら子は非表示

■ 視認性（背景色とフォント）

親行：背景 #F2F2F2（薄グレー）、太字

子行：背景白、通常フォント

子行はインデント付き（既存実装を継続）

■ ガント右側との整合

左（タスクリスト）と右（ガント行）は常に
同じ行番号・行高さで一致すること

ガント行の背景色も親子で同じ配色を適用（左と揃える）

3.3 計画バー / 実績バー仕様
■ 計画バー（Plan）

細いバー

UI専用（DB保存禁止）

ドラッグで移動／期間調整が可能

見た目は実績バーと明確に区別すること

■ 実績バー（Actual）

process_progress_daily の集約結果から描画

ガント上でドラッグ・編集は不可（更新は入力画面）

太いバー（計画より優先して見える）

4. 日ビュー（フェーズ1の中核仕様）
4.1 ズームレベル（最低3段階）
● zoomIndex = 0（縮小）

表示範囲は _startDate 〜 _endDate（工事全期間）

UI 用に終端を少し伸ばしてもよい（余白日数）

● zoomIndex = 1（1回拡大）

表示範囲は _startDate から 45日間 程度

● zoomIndex >= 2（最大拡大）

表示範囲は _startDate から 35日間 程度

※ 45/35日は UI 都合で調整可
※ DB 日付ではなく「表示専用」の期間を作る

4.2 タイムライン計算

タイムラインの幅は必ず次の計算で作る：

displayStart = _getDayViewDisplayStart(zoomIndex)
displayEnd   = _getDayViewDisplayEnd(zoomIndex)
visibleDays  = (displayEnd - displayStart) + 1
daysCount    = max(visibleDays, requiredDays)
totalWidth   = dayWidth * daysCount


index → 日付変換：displayStart + index日

週/月ビューの期間計算はフェーズ1では変更しない

4.3 横スクロールとヘッダー同期

本体ガント（ScrollController）を 唯一の真実 とする

ヘッダーは必ず本体スクロールに同期

ヘッダーをドラッグした場合も本体が動く

ホイールやトラックパッドスクロールも同期

ピクセルずれ防止のため、ScrollController.position.pixels を統一使用

5. ガント行（右側グリッド）

左のタスクリストと 行数・順序・高さが完全一致

親行は背景グレー、子行は白

行間に1px程度の区切り線を入れてもよい

バー（計画／実績）は背景色の上に描画すること

6. ミニマップ（フェーズ1では簡易版）

ミニマップの表示は任意（なくてもOK）

あれば以下のみ満たせばよい：

青い枠（viewport）は mainScroll.offset と
viewportWidth / contentWidth の比率で描画

少々のズレはフェーズ1の範囲では許容

ミニマップから本体をドラッグして操作する機能は
フェーズ2で実装する（フェーズ1では不要）

7. フェーズ1で「やらない」もの（変更禁止）

以下はフェーズ2以降にまわす：

Excel的「日=3か月／週=1年／月=3年」の無制限スクロール

today基準の仮想タイムライン

ミニマップ → 本体の逆スクロール操作

製品→工程グループ→工程ステップの3階層ツリー

PDF/Excel 出力

ガント上で実績バーを編集

3D風ガントやアニメーション

8. Codexへの指示（最重要）

Codex は今後：

この UI_GANTT_PHASE1.md を
SPEC.md と同レベルの 固定仕様書 として扱うこと

修正時は常にこの仕様に従うこと

仕様外の改変を提案しない／自動で置き換えない

画面挙動を巻き戻す実装をしない

この仕様を破壊しそうな PR は拒否すること

以上。
本仕様は pms ガントUI のフェーズ1 公式仕様書とする。